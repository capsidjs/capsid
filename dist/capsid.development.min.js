var capsid = (function(n) {
  'use strict'
  function t(n, t) {
    if (!n) throw new Error(t)
  }
  function e(n) {
    t('string' == typeof n, 'The name should be a string'), t(!!o[n], 'The coelement of the given name is not registered: ' + n)
  }
  var o = {},
    i = document,
    r = new Promise(function(n) {
      var t = function t() {
        'complete' === i.readyState && (n(), i.removeEventListener('readystatechange', t))
      }
      i.addEventListener('readystatechange', t), t()
    }),
    c = i.documentElement,
    u = function(n, t) {
      var r = void 0
      n ? (e(n), (r = [n])) : (r = Object.keys(o)),
        r.map(function(n) {
          ;[].map.call((t || i).querySelectorAll(o[n].sel), o[n])
        })
    },
    a = [],
    f = function(n, t) {
      ;(n.$I = !0), (n.$N = t), (n.capsid = L), 'function' == typeof n.__init__ && n.__init__()
    },
    l = function(n, t, e) {
      n.$I || f(n, e)
      var o = new n()
      return (
        (o.el = t),
        e && (t['$D' + e] = o),
        (n.$K || []).map(function(n) {
          n(t, o)
        }),
        a.forEach(function(n) {
          n(t, o)
        }),
        'function' == typeof o.__init__ && o.__init__(),
        o
      )
    },
    s = function(n, e) {
      t('string' == typeof n, '`name` of a class component has to be a string.'), t('function' == typeof e, '`Constructor` of a class component has to be a function')
      var i = n + '-initialized',
        c = function(t, o) {
          var r = t.classList
          r.contains(i) || (r.add(n, i), l(e, t, n))
        }
      ;(c.sel = '.' + n + ':not(.' + i + ')'),
        (o[n] = c),
        r.then(function() {
          u(n)
        })
    },
    m = function(n, o) {
      e(n)
      var i = o['$D' + n]
      return t(i, 'no coelement named: ' + n + ', on the dom: ' + o.tagName), i
    },
    p = function(n, t) {
      e(n), o[n](t)
    },
    h = function(n, t) {
      return p(n, t), m(n, t)
    },
    v = function(n) {
      'function' == typeof capsidDebugMessage && capsidDebugMessage(n)
    },
    d = function(n) {
      var t = (arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}).at
      return function(e, o) {
        var i = e.constructor
        i.$K = (i.$K || []).concat(function(e, i) {
          e.addEventListener(n, function(n) {
            ;(t &&
              ![].some.call(e.querySelectorAll(t), function(t) {
                return t === n.target || t.contains(n.target)
              })) ||
              (v({ type: 'event', e: n, el: e, coelem: i }), i[o](n))
          })
        })
      }
    },
    g = d('click'),
    _ = function(n, t, e, o) {
      n.dispatchEvent(new CustomEvent(t, { detail: o, bubbles: e }))
    },
    y = function(n) {
      return function(t, e, o) {
        var i = o.value
        o.value = function() {
          var t = this,
            e = i.apply(this, arguments),
            o = function(e) {
              return _(t.el, n, !0, e)
            }
          return e && e.then ? e.then(o) : o(e), e
        }
      }
    }
  y.first = function(n) {
    return function(t, e, o) {
      var i = o.value
      o.value = function() {
        return _(this.el, n, !0, arguments[0]), i.apply(this, arguments)
      }
    }
  }
  var b = c.matches || c.webkitMatchesSelector || c.msMatchesSelector,
    w = function(n) {
      return n.replace(/(?!^)[A-Z]/g, '-$&').toLowerCase()
    },
    E = function(n, t) {
      return function(e, o, i) {
        var r = t || '.' + n
        i.get = function() {
          if (b.call(this.el, r)) return m(n, this.el)
          var t = this.el.querySelectorAll(r)
          if (t.length) return m(n, t[0])
          throw new Error('wired class-component "' + n + '" is not available at ' + this.el.tagName + '(class=[' + this.constructor.name + ']')
        }
      }
    },
    S = function(n, t, e) {
      if ('string' == typeof n) return E(n, t)
      E(w(t))(n, t, e)
    }
  ;(S.el = function(n) {
    return function(t, e, o) {
      o.get = function() {
        return this.el.querySelector(n)
      }
    }
  }),
    (S.elAll = function(n) {
      return function(t, e, o) {
        o.get = function() {
          return this.el.querySelectorAll(n)
        }
      }
    })
  var $ = function n(t) {
      return 'function' != typeof t
        ? function(n) {
            return s(t, n), n
          }
        : n(w(t.name))(t)
    },
    k = function(n, t) {
      return function(e, o, i) {
        var r = i.value
        i.value = function() {
          var e = this,
            o = r.apply(this, arguments),
            i = [].forEach,
            c = function(o) {
              i.call(e.el.querySelectorAll(t), function(t) {
                return _(t, n, !1, o)
              })
            }
          return o && o.then ? o.then(c) : c(o), o
        }
      }
    }
  d.click = g
  var A = y,
    q = k,
    L = Object.freeze({ def: s, prep: u, make: h, mount: l, get: m, on: d, emit: A, emits: y, wire: S, component: $, pub: q, notifies: k, __ccc__: o, pluginHooks: a })
  return (n.def = s), (n.prep = u), (n.make = h), (n.mount = l), (n.get = m), (n.on = d), (n.emit = A), (n.emits = y), (n.wire = S), (n.component = $), (n.pub = q), (n.notifies = k), (n.__ccc__ = o), (n.pluginHooks = a), n
})({})
